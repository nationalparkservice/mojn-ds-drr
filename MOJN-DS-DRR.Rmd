---
params:

  reportNumber: ""                           # Optional. Only include this if publishing in the semi-official Data Release Report Series. Contact Joe if you are.
  reportRefID: 2300894
  packageAbstract: >-
    This report summarizes data quality evaluations of discrete data collected for the Mojave Desert Network Inventory and Monitoring Program (MOJN I&M) Desert Springs protocol from 2016 to 2022. This protocol is designed to monitor hydrological and ecological condition at 250 springs in Death Valley National Park (DEVA), Joshua Tree National Park (JOTR), Lake Mead National Recreation Area (LAKE), Mojave National Preserve (MOJA), and Grand Canyon-Parashant National Monument (PARA). Data collected include water quantity and water quality measurements as well as site condition information about dominant vegetation, invasive plants, disturbance, and wildlife evidence.
  dataPackage1RefID: 2300498
  dataPackage1Title: "MOJN I&M Desert Springs Data Package 2016-2023"               # Should match title in data store.
  dataPackage1Description: "MOJN I&M DS 2016-2023"  
  dataPackage2RefID: 0                              # Data Store reference ID for data set associated with this report. You must have at least one.
  dataPackage2Title: "Dataset 2 FULL TITLE"               # Should match title in data store.
  dataPackage2Description: "SHORT TITLE FOR DATASET 1"  
  dataSource: "database"  # Either "local" or "database". If "local", csv data must be in data/raw folder. If database, must be able to connect to the MOJN DS SQL Server db.
  isAccessible: "yes" # Either "yes" for a version that is screen-readable or "no" for a version with interactive table and plot formatting.
  wateryearStart: "2016"  # Enter the start and end year for data that you want this report to include by default (can be the same year)
  wateryearEnd: "2023"

pagetitle: "MOJN DS QC 2016-2023"
lang: "en"
title: |
    | Mojave Desert Network Desert Springs Protocol
    | Data Quality Control Report `r params$reportNumber`
subtitle: |
  | Data Package 2016-2023  
author:
  - name: "Jennifer Bailard, Sarah Wright, and Mark Lehman"
    affiliation: |
      | Mojave Desert Network
      | Inventory and Monitoring Program 
      | 101 Katzenbach Drive
      | Boulder City, Nevada
date: "`r format(Sys.time(), '%d %B, %Y')`"
abstract: "`r params$packageAbstract`"
editor_options:
  chunk_output_type: inline
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
link-citations: yes
output:
  html_document:
    self_contained: true
    template: template_new.html
    df_print: kable
    fig_caption: true
    dev: svg
    highlight: null
    smart: no
    theme: journal
    css: !expr here::here('common', 'journalnps.min.css')
    toc: yes
    toc_float: true
    number_sections: true
    includes:
        before_body:
          - !expr here::here('common', 'header.html')
        after_body: 
          - !expr here::here('common', 'footer.html')
  word_document:
    df_print: kable
    fig_caption: yes
    fig_height: 5
    fig_width: 5
    highlight: haddock
    reference_docx: !expr here::here('common', 'DRR Word Template.docx')
---

```{r setup, include = FALSE}
# This setup code loads both reproducible reporting packages
# (delete those not needed) and packages for the actual project.
# Note that it also generates the start of a BibTex literature cited
# including the citations for R and all used packages

# reproducible reporting packages
RRpackages <- c('markdown',     # links to Sundown rendering library
                'rmarkdown',    # newer rendering via pandoc
                'pander',       # alternative renderer for markdown, plus better tables than just knitr
                'knitr',
                "dataMaid",     # for makeCodebooks
                "R.rsp",        # dynamic generation of scientific reports
                "kimisc",       #
                "papeR",        # stat tables
                "texreg",       # formatting regression results for LaTeX or html
                "rmdHelpers",   # misc from Mark Peterson thisFileName() thisFile_knit()
                'yaml',         # format data into markdown
                'rmdformats',   # templates including automatic ToC, also use_bookdown()
                'htmltools',    #
                "bibtex",
                "RefManageR",   # BibTeX reference manager
                "knitcitations",# For working with file paths
                "here"          # nice HTML widget tables
)

inst <- RRpackages %in% installed.packages()
if (length(RRpackages[!inst]) > 0) {
  install.packages(RRpackages[!inst], dep = TRUE, repos = "http://cran.rstudio.com/") # "https://cloud.r-project.org"
}
lapply(RRpackages, library, character.only = TRUE)

# Now repeat for packages used in the analyses
pkgList <- c("devtools",        # tends to be needed/useful
             "RODBC",           # for connection to a database. 
             "EML",             # for data package creation and validation
             "kableExtra",      # added features for table formatting. 
             "english",         # converts numbers into english. Good for all that English stuff.
             "remotes",         # for install_github()
             "tidyverse",       # useful
             "formatR",
             "magrittr",
             "leaflet",
             "plotly",
             "svglite",
             "scales",
             "snakecase",
             "reactable",
             "slickR",
             "gridExtra",
             "glue",
             "tidytext",
             "DT")

inst <- pkgList %in% installed.packages()
if (length(pkgList[!inst]) > 0) {
  install.packages(pkgList[!inst], dep = TRUE, 
                   repos = "http://cran.rstudio.com/") # "https://cloud.r-project.org"
}

lapply(pkgList, library, character.only = TRUE, quietly = TRUE)

options(download.file.method = "wininet")
if (! "EMLassemblyline" %in% installed.packages()) remotes::install_github("EDIorg/EMLassemblyline")
if (! "desertsprings" %in% installed.packages()) remotes::install_github("nationalparkservice/mojn-ds-rpackage")
require("EMLassemblyline")
require("desertsprings")

# create stub of citations for packages
pkgBibTex <- lapply(c("base", pkgList, RRpackages), citation)

# pkgBibTex <- do.call()

knitr::opts_chunk$set(
  root.dir = here::here(),
  echo = FALSE,
  comment = " ",
  dev = "svg",
  tidy.opts = list(width.cutoff = 60),
  tidy = TRUE
)
# if ggplot, update theme to default to centered titles
if ("ggplot2" %in% .packages()) {
  theme_update(plot.title = element_text(hjust = 0.5))
}

knitr::opts_chunk$set(fig.width=8)

LoadDesertSprings()

# Convert start and end water years assigned in the params to a year range that can be applied to functions through the field.season parameter
wy <- as.numeric(params$wateryearStart)
end <- as.numeric(params$wateryearEnd)

years <- tibble::tibble(wy) %>%
  tibble::add_row(wy = end) %>%
  tidyr::complete(wy = tidyr::full_seq(wy, 1)) %>%
  unique() %>%
  dplyr::mutate(wy = as.character(wy))
  
year.range <- paste0(years$wy)

# Function to adjust position of axis and legend labels in plotly objects
layout_ggplotly <- function(gg, x = -0.1, y = -0.05, x_legend=1.05, y_legend=0.95, mar=list(l=50, r=150)){
  # The 1 and 2 goes into the list that contains the options for the x and y axis labels respectively
  gg[['x']][['layout']][['annotations']][[1]][['y']] <- x
  gg[['x']][['layout']][['annotations']][[2]][['x']] <- y
  # gg[['x']][['layout']][['annotations']][[0]][['x']] <- x_legend # the legend title was the 11-th list element in my case!
  gg[['x']][['layout']][['legend']][['y']] <- y_legend
  gg[['x']][['layout']][['legend']][['x']] <- x_legend
  gg %>% layout(margin = mar)
}

#Determine the output format of the document
outputFormat   = opts_knit$get("rmarkdown.pandoc.to")

#Figure and Table Caption Numbering, for HTML do it manually
capTabNo = 1; capFigNo = 1;

#Function to add the Table Number
capTab = function(x){
  if(outputFormat == 'html'){
    x = paste0("<B>Table ", capTabNo, ". ", "</B>", x)
    capTabNo <<- capTabNo + 1
  }; x
}

#Function to add the Figure Number
capFig = function(x){
  if(outputFormat == 'html'){
    x = paste0("<B>Figure ", capFigNo, ". ", "</B>", x)
    capFigNo <<- capFigNo + 1
  }; x
}
```

``` {r setup.wait, include = FALSE, eval = FALSE}
# Write YAML parameters to file for consistent reuse across report and data packages
save(params,file=here::here("data", "temp", "reportParameters.RData"))

if (params$dataSource == "database") {
  conn <- tryCatch(OpenDatabaseConnection(),
                   error = {conn <- NA})
} else {
  conn <- NA
} 
raw_data_path <- here::here("data", "raw")


```{r GenerateMetadata, eval = FALSE}
source(here::here("dataPackages", "DataPackageTemplate", "generate-metadata.R"))
```

```{r LoadData, include = FALSE}
# Load datasets for use

if (file.exists(file=here::here("data", "temp", "projectMetadata.RData"))) {
  load(file=here::here("data", "temp", "projectMetadata.RData"))
} else{
  projectMetadata<-list()
}
```

<hr>
# Background & Introduction

The following background information is summarized from the [*Springs in the Mojave Desert Network—Surface water monitoring at desert springs: Protocol narrative version 1.0*](https://irma.nps.gov/DataStore/Reference/Profile/2254900). Refer to the protocol narrative for more detailed information.

## Significance

Springs are water sources that form where groundwater reaches the land surface. They can range in size from seasonal seeps that go dry in the summer to perennial streams that flow all year long and support large wetland environments (Figure 1). Compared to the surrounding desert, spring and wetland environments in the Mojave and Great Basin regions support a greater abundance and diversity of plant and animal life. Large mammals, like desert bighorn sheep, depend on standing water to survive the heat of summer. Many birds depend on riparian habitat during their migratory seasons, and bats frequent open pools when foraging for insects. Some springs support rare or endemic species, including fish, amphibians, and aquatic invertebrates. Reliable water sources are scarce, so springs are often vital to the distribution and connectivity of wildlife habitat across the landscape.

``` {r figureold, eval = FALSE, echo = FALSE, fig.align = "left", fig.asp = 0.52}

dat <- tibble::tibble(filepath = glue::as_glue(c(here::here("figures", "MOJA_P_BLA0014.JPG"),
                                                 here::here("figures", "JOTR_P_QUE0109.JPG"),
                                                 here::here("figures", "LAKE_P_SAL0019.JPG"),
                                                 here::here("figures", "PARA_P_DEA0145.JPG"),
                                                 here::here("figures", "MOJA_P_SIL0180.JPG"),
                                                 here::here("figures", "DEVA_P_COR0991.JPG"),
                                                 here::here("figures", "LAKE_P_GRA0058.JPG"),
                                                 here::here("figures", "DEVA_P_CUR0123.JPG"),
                                                 here::here("figures", "PARA_P_RAT0212.JPG"),
                                                 here::here("figures", "DEVA_P_GNO0081.JPG"),
                                                 here::here("figures", "DEVA_P_COT0794.JPG"),
                                                 here::here("figures", "JOTR_P_COT0294.JPG"))))

alt_text <- c("Small, muddy puddle emerges from hillside, with cattle activity in the spring. There are some posts and other old remains of an exclosure fence around the source.",
              "Small pool is situated in sand and bedrock at the bottom of a bouldery canyon.",
              "Hot spring flows over a waterfall in a narrow canyon and is dammed by sandbags at the bottom to form a bathing pool.",
              "Shallow, broad pond is situated in a grassy depression with pine trees in the background.",
              "Shallow springbrook emerges from a qanat, with active pipe diversion and cattle activity in the spring.",
              "Small pool supporting goldenrods emerges from a very steep hillside with little other vegetation around.",
              "High discharge spring flows over a waterfall into a large, deep pool in a narrow canyon. The canyon is full of lush riparian vegetation, including cattails, monkeyflowers, grapevines, willows, and ferns.",
              "Small, shallow pool emerges in the middle of sparse desert shrubland and flows for a few meters down a gradual slope.",
              "Water seeps out of contacts between bedrock layers, with active pipe diversion of the seepage.",
              "Long, narrow springbrook winds through a crusty salt flat devoid of vegetation.",
              "Shallow springbrook is covered by aquatic plants in the shade of large cottonwood trees and other woody vegetation.",
              "Dry spring is situated in a sandy wash below cluster of fan palms in a bouldery canyon.")

cap <- c("Black Bird Mine Spring, Mojave National Preserve",
         "Queen Mountain Spring, Joshua Tree National Park",
         "Salt Cedar Hot Spring, Lake Mead National Recreation Area",
         "Death Valley Pond, Parashant National Monument",
         "Silver Lead Qanat, Mojave National Preserve",
         "Corkscrew Spring, Death Valley National Park",
         "Grapevine Spring, Lake Mead National Recreation Area",
         "Currie Wells, Death Valley National Park",
         "Rattlesnake Spring, Parashant National Monument",
         "Gnome Spring, Death Valley National Park",
         "Cottonwood Spring, Death Valley National Park",
         "Cottonwood Palm Spring, Joshua Tree National Park")

imgs_alt <- mapply(function(x, txt){
  htmltools::tags$img(src = knitr::include_graphics(x), alt = txt)
}, x = dat$filepath, txt = alt_text, SIMPLIFY = FALSE)

cP1 <- htmlwidgets::JS("function(slick,index) {
                            return '<a>'+(index+1)+'</a>';
                       }")

opts_dot_number <- slickR::settings(
    focusOnSelect = TRUE,
    dots = TRUE,
    customPaging = cP1,
    accessibility = TRUE
    )

slick_dots <- slickR::slickR(
  obj = imgs_alt,
  height = 400,
  width = "60%"
  ) + slickR::settings(lazyLoad = "progressive",
                       prevArrow = "<button class='slick-prev slick-arrow' aria-label='Previous image' type='button' style>",
                       nextArrow = "<button class='slick-next slick-arrow' aria-label='Next image' type='button' style>")

slick_cap_synch <- slickR::slickR(obj = cap,
                                  slideType = "p"
                                  ) + slickR::settings(arrows = FALSE)

slick_dots %synch% slick_cap_synch # + opts_dot_number 

```

``` {r figure1, echo = FALSE, fig.align = "left", fig.cap = capFig("Examples of springs in the Mojave Desert."), fig.asp = 0.52, fig.alt = "Twelve photos of diverse springs across the network parks."}

dat <- tibble::tibble(filepath = glue::as_glue(c("https://npgallery.nps.gov/GetAsset/8cf94375-0819-4a96-bffa-f7771664324b/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/c5aa83f8-0f60-4091-9a32-e6a6fe93eb65/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/d0546fa9-2956-4fe0-9d47-8e1cfeec19b4/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/96aff2be-7d10-4211-bed9-5318ecdc40e7/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/828dc8c0-6895-4934-b519-41145845ea3c/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/179aefeb-328c-475c-9f6c-7ad7d50c1c1d/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/0c71ddef-8bf5-4614-b12e-8c7e5bc02ad3/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/5af8c79f-53ce-4258-ae8e-c7f265ec9c96/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/135b6b3d-1af5-4d64-a75b-a10540f6775e/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/0dffb355-fde9-4337-8fa4-76eb052a141d/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/8b837275-0dc2-4a89-b738-89fe9b9580dc/proxymdres.jpg",
                                                 "https://npgallery.nps.gov/GetAsset/0faa0a42-a63c-409a-8326-19aaee9d9738/proxymdres.jpg")))

alt_text <- c("Small, muddy puddle emerges from hillside, with cattle activity in the spring. There are some posts and other old remains of an exclosure fence around the source.",
              "Small pool is situated in sand and bedrock at the bottom of a bouldery canyon.",
              "Hot spring flows over a waterfall in a narrow canyon and is dammed by sandbags at the bottom to form a bathing pool.",
              "Shallow, broad pond is situated in a grassy depression with pine trees in the background.",
              "Shallow springbrook emerges from a qanat, with active pipe diversion and cattle activity in the spring.",
              "Small pool supporting goldenrods emerges from a very steep hillside with little other vegetation around.",
              "High discharge spring flows over a waterfall into a large, deep pool in a narrow canyon. The canyon is full of lush riparian vegetation, including cattails, monkeyflowers, grapevines, willows, and ferns.",
              "Small, shallow pool emerges in the middle of sparse desert shrubland and flows for a few meters down a gradual slope.",
              "Water seeps out of contacts between bedrock layers, with active pipe diversion of the seepage.",
              "Long, narrow springbrook winds through a crusty salt flat devoid of vegetation.",
              "Shallow springbrook is covered by aquatic plants in the shade of large cottonwood trees and other woody vegetation.",
              "Dry spring is situated in a sandy wash below cluster of fan palms in a bouldery canyon.")

cap <- c("Black Bird Mine Spring, Mojave National Preserve",
         "Queen Mountain Spring, Joshua Tree National Park",
         "Salt Cedar Hot Spring, Lake Mead National Recreation Area",
         "Death Valley Pond, Parashant National Monument",
         "Silver Lead Qanat, Mojave National Preserve",
         "Corkscrew Spring, Death Valley National Park",
         "Grapevine Spring, Lake Mead National Recreation Area",
         "Currie Wells, Death Valley National Park",
         "Rattlesnake Spring, Parashant National Monument",
         "Gnome Spring, Death Valley National Park",
         "Cottonwood Spring, Death Valley National Park",
         "Cottonwood Palm Spring, Joshua Tree National Park")

imgs_alt <- mapply(function(x, txt){
  htmltools::tags$img(src = x, alt = txt)
}, x = dat$filepath, txt = alt_text, SIMPLIFY = FALSE)

cP1 <- htmlwidgets::JS("function(slick,index) {
                            return '<a>'+(index+1)+'</a>';
                       }")

opts_dot_number <- slickR::settings(
    focusOnSelect = TRUE,
    dots = TRUE,
    customPaging = cP1,
    accessibility = TRUE
    )

slick_dots <- slickR::slickR(
  obj = imgs_alt,
  height = 400,
  width = "60%"
  ) + slickR::settings(#lazyLoad = "progressive",
                       prevArrow = "<button class='slick-prev slick-arrow' aria-label='Previous image' type='button' style>",
                       nextArrow = "<button class='slick-next slick-arrow' aria-label='Next image' type='button' style>")

slick_cap_synch <- slickR::slickR(obj = cap,
                                  slideType = "p"
                                  ) + slickR::settings(arrows = FALSE)

slick_dots %synch% slick_cap_synch # + opts_dot_number 

```

## Threats and Stressors

Springs are vulnerable to multiple stressors, including climate change and groundwater withdrawal. In the southwestern United States, increasing air temperatures and declining snowpacks have intensified drought and reduced aquifer recharge (Gonzalez et al. 2018). Springs fed by small, local aquifers are particularly vulnerable to drought. They may experience lower discharge or even go dry entirely. Springs fed by larger, regional aquifers are more resilient to recent climate change but may be vulnerable to groundwater withdrawal happening outside of their park. For large aquifers with slow recharge, it may take centuries for water levels to recover after pumping is discontinued (Bredehoeft and Durbin 2009). At all springs, higher air temperatures can lead to water loss through increases in evapotranspiration as well as changes in plant communities and wildlife use patterns.

Other stressors include surface water diversions, livestock disturbance, recreation, and invasive species. Active and historical diversions, such as pipes and troughs, are widespread at springs within the network and may alter or eliminate downstream riparian habitat. Grazing and trampling by livestock, such as cattle, feral donkeys (burro), and feral horses, can also negatively affect riparian vegetation and habitat. Threats from improper recreation include social trails, fire pits, bank degradation, and failure to dispose of garbage and human waste. Invasive trees like salt cedar and palms often outcompete native plants for limited water and nutrients, and invasive grasses are shifting fire regimes across the landscape. Invasive animals, including amphibians, fish, arthropods, and molluscs, can put pressure on native species through predation, hybridization, or competition for resources.

## Sample Design

The Mojave Desert Network Inventory and Monitoring Program (MOJN I&M) monitors 248 springs across Death Valley National Park (DEVA), Joshua Tree National Park (JOTR), Lake Mead National Recreation Area (LAKE), Mojave National Preserve (MOJA), and Grand Canyon-Parashant National Monument (PARA) as part of the Desert Springs protocol (Figure 2). Springs were selected at each park using a Generalized Random Tessellation Stratified (GRTS) spatially-balanced random sample.

A subset of 60 springs are monitored annually and are equipped with data-logging sensors to provide continuous records of surface water presence. There are 20 annual springs in DEVA and 10 annual springs in each of the other four parks. The remaining 188 springs are monitored on a 3-year rotation. There are 60 3-year springs in DEVA, 35 in MOJA, 35 in PARA, 33 in LAKE, and 25 in JOTR. Approximately 120 springs are monitored each field season.

``` {r figure2, echo = FALSE, fig.align = "left", out.width = "100%", fig.cap = capFig("Map of desert springs monitoring locations. Blue circles indicate springs monitored every year. Red circles indicate springs monitored every three years. Small yellow circles indicate springs that were inventoried but not typically monitored."), fig.alt = "Map of 248 springs monitored by MOJN I&M across the five network parks."}
locationmap <- LocationMap()

locationmap
```

## Monitoring Questions

Given the ecological importance of springs and the threats that they face, the Desert Springs protocol was developed to address the following monitoring questions:

- Is water availability at springs changing over time?
- Is water quality at springs changing over time?

The protocol investigates these monitoring questions by collecting long-term data for the following quantitative measurable objectives:

- Status and trends of water availability (flow condition, discharge, and surface water length).
- Status and trends of water quality (temperature, pH, specific conductance, and dissolved oxygen).

In addition to these measurable objectives, the protocol also collects qualitative site condition information, including:

- Dominant vegetation
- Invasive plants
- Disturbance
- Wildlife evidence
- Repeat photographs

Because MOJN I&M field crews are often the only NPS field crews visiting many of these springs regularly, this site condition information can provide park managers with useful information about springs that would not be collected otherwise.

# Methods

## Data Collection

Field methods are described in [*Springs in the Mojave Desert Network—Surface water monitoring at desert springs: Standard operating procedures version 1.0*](https://irma.nps.gov/DataStore/Reference/Profile/2256063). Specific methods include SOP 4: Spring Acceptance and Classification, SOP 5: Water Availability: Flow Condition, SOP 6: Water Availability: Data-Logging Sensors, SOP 7: Water Quality, SOP 8: Site Condition: Spring Vegetation, SOP 9: Site Condition: Invasive Plants, SOP 10: Site Condition: Disturbance, and SOP 11: Site Condition: Repeat Photographs. Table 1 summarizes all measurements that are collected for the protocol.

``` {r table1, fig.cap = capTab("Monitoring data collected for the Desert Springs protocol.")}

type <- c("Quantitative", "Quantitative", "Quantitative", "Qualitative", "Qualitative", "Qualitative", "Qualitative", "Qualitative")

msr <- c("Water Availability (Discrete)", "Water Availability (Continuous)", "Water Quality", "Dominant Vegetation", "Invasive Plants", "Wildlife Evidence", "Disturbance", "Repeat Photographs")

dscr <- c("Flow condition (presence or absence of surface water), discharge (flow rate of surface water), surface water dimensions (length and width of surface water)", "Record of wet / dry cycle (data-logging sensors)", "Core parameters (temperature, pH, specific conductance, and dissolved oxygen)", "Ranking of vegetation life forms within spring area", "List of invasive plants found within spring area", "List and description of wildlife evidence within spring area", "Index of natural and anthropogenic disturbances within spring area", "Visual documentation of spring source, upstream, and downstream")

tbl <- tibble::tibble(type, msr, dscr) %>%
  dplyr::rename(MeasurementType = type,
                Measurement = msr,
                Description = dscr)

tbl %>%
    reactable::reactable(
              compact = TRUE,
              striped = TRUE,
              bordered = TRUE,
              highlight = TRUE,
              resizable = TRUE,
              columns = list(
                MeasurementType = reactable::colDef(minWidth = 130,
                                                    name = "Measurement Type"),
                Measurement = reactable::colDef(minWidth = 180),
                Description = reactable::colDef(minWidth = 300)))
```

## Data Processing

Data were evaluated using a collection of QC checks that are part of the MOJN I&M Desert Springs R package. These evaluations are summarized in Section 4 of this document. Where unresolvable data quality issues exist, the data have been assigned a flag to indicate the level of concern and further described by a flag note. These flags include Information (not expected to impact the validity of the data), Warning (care should be taken when including the data in analyses), and Critical (serious concerns about the quality of the data which should not be used in analyses).

## Code Availability

All of the code used in the preparation of this data package and QC report is available at the [MOJN I&M Desert Springs R Package repository v0.1.0](https://github.com/nationalparkservice/mojn-ds-rpackage/releases/tag/v0.1.0) on Github.

# Data Records
The published product is one data package containing multiple CSV data files:

* [**`r params$dataPackage1Title`**](`r paste0("https://irma.nps.gov/DataStore/Reference/Profile/", params$dataPackage1RefID)`). Comma-separated text files containing data from the MOJN I&M Desert Springs protocol. These data were compiled by MOJN I&M and were last updated on `r format(Sys.Date(), '%B %d, %Y')`.

Eighteen CSV data files contain raw values suitable for use with the MOJN I&M Desert Springs R package (Table 2).

A data dictionary for all of the tables and fields in the published CSV files is provided in XML format with this data package. 

```{r table2, echo = FALSE, fig.cap = capTab("File names and descriptions of published CSVs accompanying this data QC report.")}
FileName <- c("CalibrationDO", "CalibrationpH", "CalibrationSpCond", "DischargeEstimated", "DischargeFlowCondition", "DischargeVolumetric", "Disturbance", "DisturbanceFlowModification", "Invasives", "Riparian", "Site", "Visit", "VisitActivity", "WaterQualityDO", "WaterQualitypH", "WaterQualitySpCond", "WaterQualityTemperature", "Wildlife")
Description <- c("Dissolved oxgyen calibration records", "pH calibration records", "Specific conductance calibration records", "Visually estimated discharge categories", "Springbrook lengths, widths, and flow condition categories", "Volumetrically collected discharge measurements", "Natural and anthropogenic disturbance presence, cover classes, and descriptions", "Presence and type of surface flow modifications", "Invasive vegetation species observations", "Vegetation life form category presence, rank, and dominant species", "Locations of spring sites in this dataset", "Sample frames, visit types, and monitoring status of spring sites", "Summary of types of data collected during site visits", "Dissolved oxygen measurements in springs", "pH measurements in springs", "Specific conductance measurements in springs", "Water temperature measurements in springs", "Wildlife use evidence types and descriptions")
tbl <- data.frame(FileName, Description)

tbl %>%
  reactable::reactable(
          columns = list(FileName = reactable::colDef(name = "Filename",
                                                      minWidth = 140),
                         Description = reactable::colDef(minWidth = 320)),
          pagination = FALSE,
          compact = TRUE,
          striped = TRUE,
          bordered = TRUE,
          highlight = TRUE,
          resizable = TRUE)

```

# Data Quality Evaluation

The data in the data package described above have been reviewed by staff in the NPS Inventory and Monitoring Division to ensure accuracy, completeness, and consistency with documented data quality standards, as well as for usability and reproducibility. For additional information on data quality standards for this protocol, refer to [*Data Quality Standards for Springs in the Mojave Desert Network–Surface Water Monitoring at Desert Springs*](https://irma.nps.gov/DataStore/Reference/Profile/2257548).

## Advice and Caveats

- During the first field season in WY2016, LAKE springs were monitored in March and April. In all subsequent field seasons, LAKE springs were monitored in November and December.
- CAMO was established in February 2016. It was inventoried in November 2016, and two springs were identified for monitoring. These two springs are monitored opportunistically every three years at the same time as the MOJA 3-year springs.
- In WY2016, water quality instruments were not maintained to modern protocol standards. In particular, dissolved oxygen and pH measurements from the first field season may not be high quality data.
- In WY2018, calibration and measurement of dissolved oxygen percent began using the local dissolved oxygen percent convention. While calibrating to local dissolved oxygen, the calibration value is 100% regardless of the barometric pressure at the time of calibration, because the calibration environment is at 100% oxygen pressure for that specific location. Dissolved oxygen percent may not be comparable between years before and after this change.
- Beginning in WY2019, ungulate observations were separated from mammal observations in wildlife evidence.
- Due to the 35-day lapse in federal appropriations from late December 2018 to late January 2019, one annual spring in DEVA and both springs in CAMO were not monitored during WY2019.
- Due to COVID-19 pandemic travel restrictions beginning in March 2020, monitoring of annual and 3-year springs was not completed in PARA during WY2020.
- Due to COVID-19 pandemic travel restrictions from December 2020 to February 2021, monitoring of 3-year springs was not completed in DEVA during WY2021. Some annual springs were monitored later than usual during the field season, when field work was allowed to resume.
- Beginning in WY2021, measurement of springbrook length was separated into continuous and discontinuous measurements. Previously, only continuous springbrook length was measured.

## General {.tabset .tabset-pills}

### Completeness 

This table provides the number and percentage of springs monitored at each park for each field season. Large disruptions to the field season occurred in WY2019 with the 35-day lapse in federal appropriations and in WY2020 and WY2021 with travel restrictions due to the COVID-19 pandemic.

``` {r completeness, message = FALSE, warning = FALSE, fig.cap = capTab("Number and percentage of springs monitored at each park and field season.")}
completeness <- qcCompleteness(field.season = year.range)

completeness %<>%
  dplyr::mutate(Percent = round(Percent, 1)) %>%
  dplyr::filter(MonitoringStatus == "Sampled")

completeness %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       defaultColDef = reactable::colDef(
                         header = function(value) snakecase::to_title_case(value)))
```

### Completeness plot

This stacked bar plot shows the percentage of springs monitored at each park for each field season. Large disruptions to the field season occurred in WY2019 with the 35-day lapse in federal appropriations and in WY2020 and WY2021 with travel restrictions due to the COVID-19 pandemic.

``` {r completeness.plot, message = FALSE, warning = FALSE, out.width = "100%", fig.cap = capFig("Annual and 3-yr spring sampled and not sampled at each park for each field season."), fig.alt = "Stacked bar plot showing the number of springs that were sampled and not sampled at each park for each field season. Parashant in water year 2020 and Death Valley in water year 2021 had the lowest completeness due to the pandemic."}
completeness.plot <- qcCompletenessPlot(field.season = year.range)

if (params$isAccessible == "yes") {
  completeness.plot
} else {
  ggplotly(completeness.plot) %>%
    layout(
      legend = list(
        orientation = "h",
        y = -0.2,
        title = list(text = "Sample Status")
      )
    )  
}
```

### Not sampled

This table lists springs that were not sampled during a field season or visit when they were intended to be monitored.

``` {r notsampled, fig.cap = capTab("Springs that were not samped during a field season.")}
notsampled <- qcNotSampled(field.season = year.range)

notsampled %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       defaultColDef = reactable::colDef(
                        header = function(value) snakecase::to_title_case(value)))
```

### Not active panel visits

This table lists visits to springs that are not currently in an active sample frame or monitoring panel (e.g., annual and three-year springs). Many oversample springs were visited in MOJA, JOTR, and PARA during the first two years of protocol implementation because the network had sufficient personnel and resources to complete a full inventory of accessible springs in those parks. Some oversample springs are visited opportunistically to monitor specific resource concerns, such as springs in recently burned areas.

``` {r notactive, fig.cap = capTab("Visits to springs that are not currently in an active sample frame or monitoring panel.")}
notactive <- qcPanelCheck(field.season = year.range)

notactive %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       defaultColDef = reactable::colDef(
                        header = function(value) snakecase::to_title_case(value)))
```

### Not primary visits

This table lists springs with any other combination of visit types other than one primary visit for each field season. Typically, if a spring is visited during a field season, then the spring should have one primary visit associated with it. Mistakes may occur when more than one visit to the same spring in the same field season is considered primary, or if no visits to a spring in a given field season are considered primary. This list also returns all springs that have supplemental, replicate, or dummy visits to allow the user to more easily check for mistakes.

Primary visits involve collecting official data for the protocol. Supplemental visits involve collecting specific data to supplement the data collected during the primary visit. Supplemental visits typically occur when a sensor is inadvertently forgotten during the primary visit and the spring is revisited later in the field season for sensor deployment. Replicate visits involve collecting a full set of data in addition to the data collected during the primary visit. Replicate visits may occur during training or when calibrating or comparing field crews. Dummy visits usually involve test entries that are created to identify and fix bugs in the Survey123 form or AGOL database. Dummy visits should not be included in the published dataset.

``` {r notprimary, fig.cap = capTab("Springs that had any other combination of visit types other than one primary visit for each field season.")}
notprimary <- qcVisitTypeCheck(field.season = year.range)

notprimary %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       defaultColDef = reactable::colDef(
                        header = function(value) snakecase::to_title_case(value)))
```

### Repeat visits

This table provides a list of springs that were visited multiple times during a field season for review. Supplemental visits involve collecting specific data to supplement the data collected during the primary visit. Supplemental visits typically occur when a sensor is inadvertently forgotten during the primary visit and the spring is revisited later in the field season for sensor deployment. Replicate visits involve collecting a full set of data in addition to the data collected during the primary visit. Replicate visits may occur during training or when calibrating or comparing field crews.

``` {r repeats, fig.cap = capTab("Springs visited more than one time per field season.")}
repeats <- qcRepeatVisits(field.season = year.range) %>%
  dplyr::select(-MonitoringStatus)

reactable::reactable(dplyr::select(repeats, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                              header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- repeats$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Visit dates by spring

This table provides the date (month and day) that each spring was visited during each field season. Springs should be visited at approximately the same time of year during each field season, ideally within a few weeks, in order to minimize seasonal effects on the data.

``` {r visitsbysite, warning = FALSE, fig.cap = capTab("Date (month and day) that each spring was visited during each field season.")}
visitsbysite <- qcVisitsBySite(field.season = year.range)

visitsbysite %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       columns = list(
                         VisitDates = reactable::colDef(
                           minWidth = 115),
                         SiteCode = reactable::colDef(
                           minWidth = 160),
                         SampleFrame = reactable::colDef(
                           minWidth = 150),
                         SiteName = reactable::colDef(
                           minWidth = 150)),
                       defaultColDef = reactable::colDef(
                         header = function(value) snakecase::to_title_case(value)))
```

### Spring visits by date

This table provides the site codes of springs that were visited on each date during each field season.

``` {r visitsbydate, warning = FALSE, fig.cap = capTab("Springs that were visited on each date (month and day) during each field season.")}
visitsbydate <- qcVisitsByDate(field.season = year.range)


visitsbydate %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
              defaultColDef = reactable::colDef(
                width = 160,
                header = function(value) gsub("Y", "Y ", value)),
              columns = list(
                Date = reactable::colDef(
                  sticky = "left",
                  style = list(borderRight = "1px solid #eee"),
                  headerStyle = list(borderRight = "1px solid #eee"),
                  width = 100)))
```

### Visit dates timeline

These timelines show the date (month and day) that each spring was visited during each field season. They also show the median visit date across all field seasons at each spring. Springs should be visited at approximately the same time of year during each field season, ideally within a few weeks, in order to minimize seasonal effects on the data.

``` {r visitdate.timeline.1, warning = FALSE, fig.height = 10, out.width = "100%", fig.cap = capFig("Timeline of annual and 3-yr spring visits in DEVA."), fig.alt = "Higher elevation springs in Death Valley are visited in November to December, before snow closes the roads and passes and it gets too cold in the mountains. Lower elevation springs in Death Valley are visited in January to February, before it gets too hot on the valley floor."}
visitdate.plots <- qcVisitDateTimelines(park = "DEVA", field.season = year.range)

if (params$isAccessible == "yes") {
  visitdate.plots
} else {
  p <- ggplotly(visitdate.plots, tooltip = c("text"))
  
  for (i in 1:length(p$x$data)){
     if (!is.null(p$x$data[[i]]$name)){
         p$x$data[[i]]$name =  gsub("\\(","",str_split(p$x$data[[i]]$name,",")[[1]][1])
     }
   }
  p
}
```

``` {r visitdate.timeline.2, warning = FALSE, out.width = "100%", fig.cap = capFig("Timeline of annual and 3-yr spring visits in JOTR."), fig.alt = "Springs in Joshua Tree are typically visited in December to February."}
visitdate.plots <- qcVisitDateTimelines(park = "JOTR", field.season = year.range)

if (params$isAccessible == "yes") {
  visitdate.plots
} else {
  p <- ggplotly(visitdate.plots, tooltip = c("text"))
  
  for (i in 1:length(p$x$data)){
     if (!is.null(p$x$data[[i]]$name)){
         p$x$data[[i]]$name =  gsub("\\(","",str_split(p$x$data[[i]]$name,",")[[1]][1])
     }
   }
  p
}
```

``` {r visitdate.timeline.3, warning = FALSE, out.width = "100%", fig.cap = capFig("Timeline of annual and 3-yr spring visits in LAKE."), fig.alt = "Annual springs in Lake Mead are typically visited in late October to early November. Three-year springs are typically visited in November and December."}
visitdate.plots <- qcVisitDateTimelines(park = "LAKE", field.season = year.range)

if (params$isAccessible == "yes") {
  visitdate.plots
} else {
  p <- ggplotly(visitdate.plots, tooltip = c("text"))
  
  for (i in 1:length(p$x$data)){
     if (!is.null(p$x$data[[i]]$name)){
         p$x$data[[i]]$name =  gsub("\\(","",str_split(p$x$data[[i]]$name,",")[[1]][1])
     }
   }
  p
}
```

``` {r visitdate.timeline.4, warning = FALSE, out.width = "100%", fig.cap = capFig("Timeline of annual and 3-yr spring visits in MOJA."), fig.alt = "Springs in Mojave are typically visited in Janaury to March."}
visitdate.plots <- qcVisitDateTimelines(park = "MOJA", field.season = year.range)

if (params$isAccessible == "yes") {
  visitdate.plots
} else {
  p <- ggplotly(visitdate.plots, tooltip = c("text"))
  
  for (i in 1:length(p$x$data)){
     if (!is.null(p$x$data[[i]]$name)){
         p$x$data[[i]]$name =  gsub("\\(","",str_split(p$x$data[[i]]$name,",")[[1]][1])
     }
   }
  p
}
```

``` {r visitdate.timeline.5, warning = FALSE, out.width = "100%", fig.cap = capFig("Timeline of annual and 3-yr spring visits in PARA."), fig.alt = "Springs in Parashant are typically visited in March and April."}
visitdate.plots <- qcVisitDateTimelines(park = "PARA", field.season = year.range)

if (params$isAccessible == "yes") {
  visitdate.plots
} else {
  p <- ggplotly(visitdate.plots, tooltip = c("text"))
  
  for (i in 1:length(p$x$data)){
     if (!is.null(p$x$data[[i]]$name)){
         p$x$data[[i]]$name =  gsub("\\(","",str_split(p$x$data[[i]]$name,",")[[1]][1])
     }
   }
  p
}
```

### Spring type discrepancies

This table provides a list of springs that have been categorized differently (e.g., rheocrene vs hillslope) during different visits. Discrepancies typically occur when a spring is dry, and it is difficult to determine the spring type, or when a spring exhibits multiple spring types along its reach.

``` {r discrepancies, fig.cap = capTab("Springs that have been assigned different spring types during different visits.")}
discrepancies <- qcSpringTypeDiscrepancies(field.season = year.range)

discrepancies %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       defaultColDef = reactable::colDef(header = function(value) snakecase::to_title_case(value)))
```

### Data processing levels

This table lists site visits that have any data labeled as "Raw" or "Provisional." These data need to be reviewed and moved to "Accepted" status before publication of the dataset.

``` {r dpl.check, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = capTab("Records with data still labeled as Raw or Provisional.")}
dpl.check <- qcDPLCheck(field.season = year.range)

dpl.check %>%
  dplyr::rename_with(~ gsub(".DPL", "", .x)) %>%
  reactable::reactable(sortable = TRUE,
                       filterable = TRUE,
                       compact = TRUE,
                       striped = TRUE,
                       bordered = TRUE,
                       highlight = TRUE,
                       resizable = TRUE,
                       defaultColDef = reactable::colDef(header = function(value) if (value == "pH") {
                         value
                         } else {
                         snakecase::to_title_case(value)
                         }))
```
`r if(nrow(dpl.check) == 0){"All records have been accepted."}`
`r if(nrow(dpl.check) > 0){"The above records need to be reviewed and accepted before publication."}`

## Flow condition and water quantity {.tabset .tabset-pills}

Water quantity is the master variable in spring environments. The amount, timing, and duration of discharge control the character and extent of different aquatic habitats, the abundance of wetland plants that can be supported, and the ability of wildlife to access water for drinking.

### Spring discharge summary

This table provides spring flow condition and either estimated discharge (discharge class) or volumetric discharge for each visit.

``` {r springdischarge, fig.cap = capTab("Spring flow condition, springbrook length, and discharge.")}
springdischarge <- SpringDischarge(field.season = year.range) %>%
  dplyr::select(-Panel) %>%
  tidyr::unite("Notes", c("DischargeNotes", "SpringbrookNotes"), remove = TRUE, na.rm = TRUE, sep = " ") %>%
  dplyr::mutate(Notes = case_when(Notes == "" ~ NA_character_,
                                  TRUE ~ Notes))

reactable::reactable(dplyr::select(springdischarge, -Notes),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- springdischarge$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Spring dry, discharge or springbrook > 0

This table lists visits where the spring was recorded as dry, but either discharge or springbrook length were recorded as greater than 0.

``` {r drynonzero, fig.cap = capTab("Dry springs with recorded discharge or springbrook length.")}
drynonzero <- qcSpringDryWater(field.season = year.range) %>%
  tidyr::unite("Notes", c("DischargeNotes", "SpringbrookNotes"), remove = TRUE, na.rm = TRUE, sep = " ") %>%
  dplyr::mutate(Notes = case_when(Notes == "" ~ NA_character_,
                                  TRUE ~ Notes))

reactable::reactable(dplyr::select(drynonzero, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                   header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- drynonzero$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Spring not dry, discharge or springbrook = 0

This table lists visits where the spring was not recorded as dry and discharge was recorded as 0 or where the spring was not recorded as dry or wet soil only and springbrook length was recorded as 0. The former situation can arise when wet soil is believed to result from recent rainfall or snowmelt as opposed to groundwater discharge. The latter condition can arise when there is water dripping from a pipe that is not enough to saturate the soil below.

``` {r notdrynowater, fig.cap = capTab("Non-dry springs without recorded discharge or springbrook length.")}
notdrynowater <- qcSpringNotDryNoWater(field.season = year.range) %>%
  tidyr::unite("Notes", c("DischargeNotes", "SpringbrookNotes"), remove = TRUE, na.rm = TRUE, sep = " ") %>%
  dplyr::mutate(Notes = case_when(Notes == "" ~ NA_character_,
                                  TRUE ~ Notes))

reactable::reactable(dplyr::select(notdrynowater, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                              header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- notdrynowater$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Discharge missing

This table lists visits where estimated discharge (discharge class) or volumetric discharge were not recorded.

``` {r dischargemissing, fig.cap = capTab("Spring visits with missing discharge data.")}
dischargemissing <- qcDischargeMissing(field.season = year.range) %>%
  tidyr::unite("Notes", c("DischargeNotes", "SpringbrookNotes"), remove = TRUE, na.rm = TRUE, sep = " ") %>%
  dplyr::mutate(Notes = case_when(Notes == "" ~ NA_character_,
                                  TRUE ~ Notes))

reactable::reactable(dplyr::select(dischargemissing, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                              header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- dischargemissing$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Volumetric method data missing

This table lists visits where the volumetric method was used, but container volume, percent of flow, or fill time data were not recorded. Missing any one of these data types makes it impossible to calculate discharge.

``` {r volumetricmissing, fig.cap = capTab("Volumetric discharge measurements with missing volumetric data.")}
volumetricmissing <- qcVolumetricMissing(field.season = year.range)

volumetricmissing %>%
    reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Volumetric method fills < 5

This table lists visits where the volumetric method was used, but there are fewer than 5 fill times. Typically, at least 5 fill times are necessary to reduce the effect of outliers on determining the median fill time.

``` {r fillevents, fig.cap = capTab("Volumetric discharge measurements with fewer than five fill times.")}
fillevents <- qcVolumetricFillEvents(field.season = year.range)

fillevents %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Volumetric method median fill seconds < 5

This table lists visits where the volumetric method was used, but the median fill time was less than 5 seconds. Typically, fill times should be greater than 5 seconds to provide sufficient accuracy and precision.

``` {r filltimes, fig.cap = capTab("Volumetric discharge measurements with median fill time less than five seconds.")}
filltimes <- qcVolumetricTimes(field.season = year.range)

filltimes %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Continuous > discontinuous

This table lists visits where continuous surface water length is greater than discontinuous surface water length. This results from error during data entry.

``` {r continuouslength, fig.cap = capTab("Continuous surface water length greater than discontinuous surface water length.")}
continuouslength <- qcContinuousLength(field.season = year.range)

continuouslength %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Continuous flow category summary

This table summarizes flow categories for the continuous portion of springbrooks.

``` {r flowcatcon, fig.cap = capTab("Flow category summaries for the continuous portion of springbrooks at each park.")}
flowcatcon <- FlowCategoriesContinuous(field.season = year.range) %>%
  dplyr::select(-Panel)

flowcatcon %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Discontinuous flow category summary

This table summarizes flow categories for the discontinuous portion of springbrooks, where springbrook lengths are discontinuous, and the continuous portion of springbrooks, where springbrook lengths are continuous.

``` {r flowcatdiscon, fig.cap = capTab("Flow category summaries for the discontinuous portion of springbrooks at each park.")}
flowcatdiscon <- FlowCategoriesDiscontinuous(field.season = year.range) %>%
  dplyr::select(-Panel)

flowcatdiscon %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Flow categories annual plot

This stacked bar plot summarizes flow categories for annual springs, using the discontinuous portion of springbrooks where applicable. Flow categories include dry, wet soil only, and three classes of springbrook length (m) when surface water is present.

``` {r flowcatannualplot, fig.cap = capFig("Stacked bar plot of flow categories at annual springs for each park."), fig.alt = "Parashant and Death Valley have more annual springs with surface water present. Joshua Tree and Lake Mead have fewer annual springs with surface water present."}
flowcatannualplot <- FlowCategoriesAnnualPlot(field.season = year.range)

if (params$isAccessible == "yes") {
  flowcatannualplot
} else {
  ggplotly(flowcatannualplot) %>%
    layout(
      legend = list(
        orientation = "h",
        y = -0.2,
        title = list(text = "Flow Category")
      )
    )
}
```

### Flow categories 3-year plot

This stacked bar plot summarizes flow categories for 3-year springs, using the discontinuous portion of springbrooks where applicable. Flow categories include dry, wet soil only, and three classes of springbrook length (m) when surface water is present.

``` {r flowcat3yrplot, fig.cap = capFig("Stacked bar plot of flow categories at 3-yr springs for each park."), fig.alt = "Joshua Tree has the most three-year springs that are consistently dry, with more dry springs than springs with surface water present. The other parks have more springs with surface water present than dry springs."}
flowcat3yrplot <- FlowCategoriesThreeYearPlot(field.season = year.range)

if (params$isAccessible == "yes") {
  flowcat3yrplot
} else {
  ggplotly(flowcat3yrplot) %>%
    layout(
      legend = list(
        orientation = "h",
        y = -0.2,
        title = list(text = "Flow Category")
      )
    )
}
```

### Flow categories annual heatmap

This heatmap shows flow categories at each annual spring over all field seasons, using the discontinuous portion of springbrooks where applicable. Flow categories include dry, wet soil only, and three classes of springbrook length (m) when surface water is present.

``` {r flowcatannualheatmap.1, fig.cap = capFig("Heatmap of flow categories at annual springs in DEVA."), fig.alt = "Most annual springs in Death Valley are consistently wet or dry.", warning = FALSE}
flowcatannualheatmap <- FlowCategoriesAnnualHeatMap(park = "DEVA", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcatannualheatmap
} else {
  ggplotly(flowcatannualheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcatannualheatmap.2, fig.height = 3, fig.cap = capFig("Heatmap of flow categories at annual springs in JOTR."), fig.alt = "Most annual springs in Joshua Tree are consistently wet or dry. An exception is Queen Mountain Spring, which in some years has been dry and in other years has had flowing water greater than 50 meters long.", warning = FALSE}
flowcatannualheatmap <- FlowCategoriesAnnualHeatMap(park = "JOTR", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcatannualheatmap
} else {
  ggplotly(flowcatannualheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcatannualheatmap.3, fig.height = 3, fig.cap = capFig("Heatmap of flow categories at annual springs in LAKE."), fig.alt = "Annual springs in Lake Mead appear wetter in 2016 possibly due to the later timing of the visits during that field season."}
flowcatannualheatmap <- FlowCategoriesAnnualHeatMap(park = "LAKE", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcatannualheatmap
} else {
  ggplotly(flowcatannualheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcatannualheatmap.4, fig.height = 3, fig.cap = capFig("Heatmap of flow categories at annual springs in MOJA."), fig.alt = "Annual springs in Mojave show the most variability in being wet or dry from year to year."}
flowcatannualheatmap <- FlowCategoriesAnnualHeatMap(park = "MOJA", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcatannualheatmap
} else {
  ggplotly(flowcatannualheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcatannualheatmap.5, fig.height = 3, fig.cap = capFig("Heatmap of flow categories at annual springs in PARA."), fig.alt = "Most annual springs in Parashant tend to be consistently wet or dry. Exceptions include Mustang Spring and Yellowstone Spring, which in some years have been dry and in other years have had flowing water greater than 50 meters long."}
flowcatannualheatmap <- FlowCategoriesAnnualHeatMap(park = "PARA", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcatannualheatmap
} else {
  ggplotly(flowcatannualheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

### Flow categories 3-year heatmap

This heatmap shows flow categories at each 3-year spring over all field seasons, using the discontinuous portion of springbrooks where applicable. Flow categories include dry, wet soil only, and three classes of springbrook length (m) when surface water is present.

``` {r flowcat3yrheatmap.1, warning = FALSE, fig.height = 10, fig.cap = capFig("Heatmap of flow categories at 3-yr springs in DEVA."), fig.alt = "There is only one complete three-year cycle at Death Valley due to the pandemic. The 2021 field season was ended early."}
flowcat3yrheatmap <- FlowCategoriesThreeYearHeatMap(park = "DEVA", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcat3yrheatmap
} else {
  ggplotly(flowcat3yrheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcat3yrheatmap.2, warning = FALSE, fig.cap = capFig("Heatmap of flow categories at 3-yr springs in JOTR."), fig.alt = "Most three-year springs in Joshua Tree are dry or do not have consistent surface water from year to year."}
flowcat3yrheatmap <- FlowCategoriesThreeYearHeatMap(park = "JOTR", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcat3yrheatmap
} else {
  ggplotly(flowcat3yrheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcat3yrheatmap.3, warning = FALSE, fig.height = 6, fig.cap = capFig("Heatmap of flow categories at 3-yr springs in LAKE."), fig.alt = "Some three-year springs in Lake Mead appear wetter in 2016 possibly due to the later timing of the visits during that field season."}
flowcat3yrheatmap <- FlowCategoriesThreeYearHeatMap(park = "LAKE", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcat3yrheatmap
} else {
  ggplotly(flowcat3yrheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcat3yrheatmap.4, warning = FALSE, fig.height = 6, fig.cap = capFig("Heatmap of flow categories at 3-yr springs in MOJA."), fig.alt = "There are some three-year springs in Mojave that are consistently dry, but most have had surface water present during at least one visit."}
flowcat3yrheatmap <- FlowCategoriesThreeYearHeatMap(park = "MOJA", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcat3yrheatmap
} else {
  ggplotly(flowcat3yrheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

``` {r flowcat3yrheatmap.5, warning = FALSE, fig.height = 6, fig.cap = capFig("Heatmap of flow categories at 3-yr springs in PARA."), fig.alt = "There are only two complete three-years cycle at Parashant due to the pandemic. The 2020 field season was ended early."}
flowcat3yrheatmap <- FlowCategoriesThreeYearHeatMap(park = "PARA", field.season = year.range)

if (params$isAccessible == "yes") {
  flowcat3yrheatmap
} else {
  ggplotly(flowcat3yrheatmap, tooltip = "text") %>%
    layout_ggplotly(x = 0, y = -0.05)
}
```

### Flow category map

This map shows flow categories at annual and 3-year springs, using the discontinuous portion of springbrooks where applicable. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r flowcatmap, echo = FALSE, message = FALSE, warning = FALSE, fig.alt = "Map of flow categories for each desert springs visit. Data for each visit can be found in the table in section 4.3.1. Spring discharge summary. Summarized data for each park can be found in the table in section 4.3.10 Discontinuous flow category summary."}
# if (params$isAccessible == "yes") {
#   flowcatmap_access <- FlowCategoriesMap(interactive = "no")
#   flowcatmap_access
# } else {
  flowcatmap_interactive <- FlowCategoriesMap(interactive = "yes", field.season = year.range)
  flowcatmap_interactive
# }
```

`r capFig("Map of flow categories at springs in each park.")`

## Water quality {.tabset .tabset-pills}

Water quality includes four parameters: water temperature, specific conductance, pH, and dissolved oxygen. Water temperature influences many chemical and physical properties of water as well as the metabolic activity of aquatic organisms. Specific conductance is related to salinity and measures the concentration of dissolved ions in the water, which can help detect contamination or disturbance. pH affects the solubility and toxicity of chemicals and heavy metals in the water. Dissolved oxygen sustains aquatic organisms that breathe aerobically, including crustaceans, mollusks, insects, amphibians, and fish.

### Water quality sanity

These are water quality values that fall above or below the ranges that we typically see in spring systems. These data are not necessarily incorrect, but they are outliers that should be evaluated using data quality flags and field notes. Wildly impossible values may be the result of instrument malfunction, improper calibration, or typos during data entry. The following records are included in the list below: temperature values greater than 30 C, pH values greater than 10 and less than 6, specific conductance values greater than 20000 uS/cm, dissolved oxygen percent values greater than 110% or less than 2%, and dissolved oxygen concentration values greater than 12 mg/L.

``` {r wqsanity, fig.cap = capTab("Water quality values that fall outside of expected ranges.")}
wqsanity <- qcWqSanity(field.season = year.range) %>%
  dplyr::select(-VisitType, -SampleFrame, -Panel)

wqsanity %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Water quality flags

These are water quality values that have data quality flags. I = Information: These data do not have any suspected problems, but there may be information regarding the equipment or conditions in which they were collected that could inform their interpretation. W = Warning: These data are suspected to have problems and should only be used after careful assessment of instrument and environmental factors. C = Critical: These data are suspected to have serious problems and are likely unusable.

``` {r wqflags, fig.cap = capTab("Water quality values that have data quality flags.")}
wqflags <- qcWqFlags(field.season = year.range) %>%
  dplyr::select(-VisitType, -SampleFrame, -Panel)

reactable::reactable(dplyr::select(wqflags, -FlagNote),
            defaultColDef = reactable::colDef(minWidth = 100,
                                              header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- wqflags$FlagNote[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Local dissolved oxygen calibration

This table lists visits where dissolved oxygen percent was not calibrated to local dissolved oxygen. When calibrating to local dissolved oxygen, the calibration value is 100% regardless of the barometric pressure at the time of calibration. The 100% calibration value for this convention reflects the fact that the calibration environment is at 100% oxygen pressure for that specific location.

``` {r dolocalcheck, fig.cap = capTab("Calibration events where dissolved oxygen was not calibrated to local dissolved oxygen.")}
localdo <- qcLocalDOCheck(field.season = year.range)

localdo %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Specific conductance standards

This table lists visits where the specific conductance standard used during calibration was much lower than the in-situ reading of specific conductance at the spring. Ideally, specific conductance standards of 10,000 uS/cm or even 50,000 uS/cm should be used at springs with consistently higher specific conductance readings.

``` {r spcondstandardcheck, fig.cap = capTab("Calibration events where specific conductance was calibrated to a standard much lower than the in-situ reading at the spring.")}
scstandard <- qcSpCondStandardCheck(field.season = year.range)

scstandard %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### pH calibration check

This table lists pH calibrations where any of the recorded values are suspect or outside of expected ranges. This includes post-calibration readings below 3.98 or above 4.10 for temperature-corrected pH 4 buffer, below 6.95 or above 7.15 for temperature-corrected pH 7 buffer, and below 9.80 or above 10.35 for temperature-corrected pH 10 buffer. This also includes buffer temperature readings below 0 C or above 40 C.

``` {r phcalcheck, fig.cap = capTab("pH calibration events with suspect values.")}
phcalcheck <- qcPHCalCheck(field.season = year.range)

phcalcheck %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Specific conductance calibration check

This table lists specific conductance calibrations where any of the recorded values are suspect or outside of expected ranges. This includes post-calibration readings that do not equal the commonly used standards of 1000 uS/cm, 1413 uS/cm, 5000 uS/cm, 10,000 uS/cm, or 50,000 uS/cm.

``` {r spcalcheck, fig.cap = capTab("Specific conductance calibration events with suspect values.")}
sccalcheck <- qcSpCondCalCheck(field.season = year.range)

sccalcheck %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Dissolved oxygen calibration check

This table lists dissolved oxygen calibrations where any of the recorded values are suspect or outside of expected ranges. This includes post-calibration readings below 70% or above 105%. This also includes temperature readings below 0 C or above 40 C and barometric pressure readings below 550 mmHg or above 770 mmHg.

``` {r docalcheck, fig.cap = capTab("Dissolved oxygen calibration events with suspect values.")}
docalcheck <- qcDOCalCheck(field.season = year.range)

docalcheck %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Water quality summary statistics

This table summarizes the median and quartile values for each water quality parameter for each park and field season during the reporting period. Both annual and 3-year springs are included. Data flagged as “Warning” or “Critical” are not included.

``` {r wqstats, fig.cap = capTab("Water quality median and quartile values for each park and field season.")}
wqstats <- WqStats(field.season = year.range)

wqstats %<>% dplyr::filter(Park != "CAMO")

wqstats %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Water temperature box plot

These box plots show the median and quartile values for water temperature (C) for each park and 3-year cycle during the reporting period. Both annual and 3-year springs are included in the 3-year cycles. Data flagged as “Warning” or “Critical” are not included.

``` {r tempplot, message = FALSE, fig.cap = capFig("Box plots of water temperature quartiles for each park and 3-year cycle."), fig.alt = "Lake Mead has the highest median and absolute water temperature values. Refer to the water quality summary statistics table in section 4.4.5. for median and quartile values."}
tempplot <- WqPlotTemp(field.season = year.range)

if (params$isAccessible == "yes") {
    tempplot
} else {
    ggplotly(tempplot) %>%
    layout_ggplotly(x = -0.04, y = -0.01)
}
```

### Specific conductance box plot

These box plots show the median and quartile values for specific conductance (uS/cm) for each park and 3-year cycle during the reporting period. Both annual and 3-year springs are included in the 3-year cycles. Data flagged as “Warning” or “Critical” are not included.

``` {r spcondplot, message = FALSE, warning = FALSE, fig.cap = capFig("Box plots of specific conductance quartiles for each park and 3-year cycle."), fig.alt = "Lake Mead has the highest median specific conductance values, while Death Valley has the highest absolute values. Joshua Tree has the lowest median values. Refer to the water quality summary statistics table in section 4.4.5. for median and quartile values."}
spcondplot <- WqPlotSpCond(field.season = year.range)

if (params$isAccessible == "yes") {
    spcondplot
} else {
    ggplotly(spcondplot) %>%
    layout_ggplotly(x = -0.04, y = -0.01)
}
```

### pH box plot

These box plots show the median and quartile values for pH for each park and 3-year cycle during the reporting period. Both annual and 3-year springs are included in the 3-year cycles. Data flagged as “Warning” or “Critical” are not included.

``` {r phplot, message = FALSE, fig.cap = capFig("Box plots of pH quartiles for each park and 3-year cycle."), fig.alt = "Most parks have median pH values between 7.5 and 8.0. Refer to the water quality summary statistics table in section 4.4.5. for median and quartile values."}
phplot <- WqPlotPH(field.season = year.range)

if (params$isAccessible == "yes") {
    phplot
} else {
    ggplotly(phplot) %>%
    layout_ggplotly(x = -0.04, y = -0.01)
}
```

### Dissolved oxygen box plot

These box plots show the median and quartile values for dissolved oxygen concentration (mg/L) for each park and 3-year cycle during the reporting period. Both annual and 3-year springs are included in the 3-year cycles. Data flagged as “Warning” or “Critical” are not included.

``` {r doplot, message = FALSE, fig.cap = capFig("Box plots of dissolved oxygen concentration quartiles for each park and 3-year cycle."), fig.alt = "Springs in all parks have a wide range of dissolved oxygen concentration values. Refer to the water quality summary statistics table in section 4.4.5. for median and quartile values."}
doplot <- WqPlotDOmgL(field.season = year.range)

if (params$isAccessible == "yes") {
    doplot
} else {
    ggplotly(doplot) %>%
    layout_ggplotly(x = -0.04, y = -0.01)
}
```

### Water temperature map

This map shows water temperature (C) at annual and 3-year springs where water was present. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r tempmap, message = FALSE, fig.alt = "Map of water temperature values for each desert springs visit where sufficient surface water was present. Summarized data for each park can be found in the table in section 4.4.5. Water quality summary statistics."}
tempmap <- WqMapTemp(field.season = year.range)

tempmap
```

`r capFig("Map of water temperature readings at springs in each park.")`

### Specific conductance map

This map shows specific conductance (uS/cm) at annual and 3-year springs where water was present. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r spcondmap, message = FALSE, fig.alt = "Map of specific conductance values for each desert springs visit where sufficient surface water was present. Summarized data for each park can be found in the table in section 4.4.5. Water quality summary statistics."}
spcondmap <- WqMapSpCond(field.season = year.range)

spcondmap
```

`r capFig("Map of specific conductance readings at springs in each park.")`

### pH map

This map shows pH at annual and 3-year springs where water was present. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r phpmap, message = FALSE, fig.alt = "Map of pH values for each desert springs visit where sufficient surface water was present. Summarized data for each park can be found in the table in section 4.4.5. Water quality summary statistics."}
phmap <- WqMapPH(field.season = year.range)

phmap
```

`r capFig("Map of pH readings at springs in each park.")`

### Dissolved oxygen map

This map shows dissolved oxygen concentration (mg/L) at annual and 3-year springs where water was present. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r domap, message = FALSE, fig.alt = "Map of dissolved oxygen concentration values for each desert springs visit where sufficient surface water was present. Summarized data for each park can be found in the table in section 4.4.5. Water quality summary statistics."}
domap <- WqMapDO(field.season = year.range)

domap
```

`r capFig("Map of dissolved oxygen concentration readings at springs in each park.")`

## Riparian vegetation {.tabset .tabset-pills}

### Vegetation present, no lifeforms

This table lists visits where vegetation was recorded as present, but no lifeforms were documented.

``` {r vegnolife, fig.cap = capTab("Vegetation present but no lifeforms documented.")}
vegnolife <- qcVegPresentNoLifeforms(field.season = year.range)

vegnolife %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### No vegetation observed, lifeforms present

This table lists visits where vegetation was not recorded as present, but lifeforms were documented.

``` {r noveglife, fig.cap = capTab("Vegetation not present but one or more lifeforms documented.")}
noveglife <- qcNoVegLifeformsPresent(field.season = year.range)

noveglife %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Lifeform present, no rank

This table lists visits where one or more lifeforms are missing a rank.

``` {r lifenorank, fig.cap = capTab("Vegetation lifeform documented but missing rank.")}
lifenorank <- qcLifeformPresentNoRank(field.season = year.range)

lifenorank %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Lifeform rank check

This table lists visits where multiple life forms have the same rank, and rank gaps have not been properly entered.

``` {r rankcheck, fig.cap = capTab("Spring visits where vegetation lifeform ranks have been incorrectly documented.")}
rankcheck <- qcLifeformRankCheck(field.season = year.range)

rankcheck %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Lifeform observations

This table counts the number of springs where each lifeform was observed in each park and field season.

``` {r lifeformobservations, fig.cap = capTab("Vegetation lifeform observations for each park and field season.")}
lifeformobservations <- LifeformsPresence(field.season = year.range)

lifeformobservations %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

## Invasive plants {.tabset .tabset-pills}

### Targeted invasive plants presence

This table lists visits where targeted invasive plants were observed. Targeted invasive plants include saltcedar (*Tamarix ramosissima*), California fan palm (*Washingtonia filifera*), date palm (*Phoenix dactylifera*), and fountain grass (*Pennisetum setaceum*). California fans palms are native to Joshua Tree National Park, so any observations there are not included in this table.

``` {r invplants, fig.cap = capTab("Targeted invasive plants observed at springs.")}
invplants <- InvasivePlants(field.season = year.range)

reactable::reactable(dplyr::select(invplants, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                              header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- invplants$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,)
```

### Targeted invasive plants map

This map shows observations of targeted invasive plant species. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r invplantmap, echo = FALSE, message = FALSE, warning = FALSE, fig.alt = "Map of invasive plant observations at desert springs. Data can be found in the table in section 4.6.1. Targeted invasive plants presence."}
invplantmap <- InvasivePlantsMap(field.season = year.range)

invplantmap
```

`r capFig("Map of targeted invasive plants observed at springs in each park.")`

## Flow modification and disturbance {.tabset .tabset-pills}

### Overall disturbance < any other disturbance category

This table lists visits where overall disturbance was less than any other disturbance category. This indicates error during data entry.

``` {r overalldisturbance, fig.cap = capTab("Overall disturbance less than any other disturbance category.")}
overalldisturbance <- qcOverallDisturbance(field.season = year.range)

overalldisturbance %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Flow modification exists, no Human Use disturbance recorded

This table lists visits were flow modification exists, but no human use disturbance was recorded at the spring.

``` {r flowmodnohumanuse, fig.cap = capTab("Flow modification present, but no human use disturbance recorded.")}
flowmodnohumanuse <- qcFlowModNoHumanUse(field.season = year.range)

flowmodnohumanuse %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Flow modification discrepancies

This table provides a list of springs where different flow modification types have been recorded during different visits. This may happen if a flow modification type is overlooked in one or more field seasons, a spring source shifts, or a different area around the spring source is searched during a visit.

``` {r flowmoddiscrepancies, fig.cap = capTab("Springs that have been assigned different flow modification types during different visits.")}
flowmoddiscrepancies <- qcFlowModDiscrepancies(field.season = year.range)

flowmoddiscrepancies %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Springs with active or historic flow modification

This table lists springs where active or inactive (historical) flow modification was observed in each field season.

``` {r flowmodstatus, fig.cap = capTab("Springs where active or inactive (historical) flow modification have been observed.")}
flowmodstatus <- FlowModStatus(field.season = year.range)

flowmodstatus %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Flow modification summary

This table lists the number and percentage of springs where active, inactive (historical), or no flow modification have been observed. In situations where there are discrepancies in flow modification observations at a spring across different field seasons, the highest level of modification has been counted.

``` {r flowmodcount, fig.cap = capTab("Number and percentage of springs with flow modification in each park.")}
flowmodcount <- FlowModCount(field.season = year.range)

flowmodcount %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Flow modification bar plot

This bar plot shows the percentage of springs in each park where active, inactive (historical), or no flow modification have been observed. In situations where there are discrepancies in flow modification observations at a spring across different field seasons, the highest level of modification has been counted.

``` {r flowmodplot, fig.cap = capFig("Stacked bar plot of flow modification status at springs in each park."), fig.alt = "Mojave has the most springs with active flow modification at 53%. Joshua Tree has the most springs with no active or historical flow modification at 83%. Summarized data for each park can be found in the table in section 4.7.5 Flow modification summary."}
flowmodplot <- FlowModPlot(field.season = year.range)

if (params$isAccessible == "yes") {
  flowmodplot
} else {
  ggplotly(flowmodplot)
}
```

### Disturbance summary

This table lists the number and percentage of springs where human use or livestock disturbance have been observed. Disturbance at a spring is counted if it has been observed at least once during the reporting period.

``` {r disturbcount, fig.cap = capTab("Number and percentage of springs with human use or livestock disturbance in each park.")}
disturbcount <- DisturbanceCount(field.season = year.range)

disturbcount %>%
  reactable::reactable(
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE,
            defaultColDef = reactable::colDef(
              header = function(value) snakecase::to_title_case(value)))
```

### Human use presence

This table lists visits where human use disturbance was recorded at a spring.

``` {r humanuseobs, fig.cap = capTab("Human use disturbance observed at springs.")}
humanuseobs <- HumanUseObservations(field.season = year.range)

reactable::reactable(dplyr::select(humanuseobs, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                       header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- humanuseobs$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Human use plot

This bar plot shows the percentage of springs in each park where human use disturbance was observed.

``` {r humanuseplot, fig.cap = capFig("Bar plots of human use disturbance observed at springs in each park."), fig.alt = "Mojave has the most springs with evidence of human use at 73%. Death Valley has the fewest at 30%. Data for each visit can be found in the table in section 4.7.8 Human use presence."}
humanuseplot <- HumanUsePlot(field.season = year.range)

if (params$isAccessible == "yes") {
  humanuseplot
} else {
  ggplotly(humanuseplot)
}
```

### Human use map

This map shows where human use disturbance was observed. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r humanusemap, echo = FALSE, message = FALSE, warning = FALSE, fig.alt = "Map of human use observations at desert springs. Data for each visit can be found in the table in section 4.7.8 Human use presence."}
humanusemap <- HumanUseMap(field.season = year.range)

humanusemap
```

`r capFig("Map of human use disturbance observed at springs in each park.")`

### Livestock presence

This table lists visits where livestock disturbance was recorded at a spring.

``` {r livestockobs, fig.cap = capTab("Livestock disturbance observed at springs.")}
livestockobs <- LivestockObservations(field.season = year.range)

reactable(dplyr::select(livestockobs, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                       header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- livestockobs$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Livestock plot

This bar plot shows the percentage of springs in each park where livestock disturbance was observed.

``` {r livestockplot, fig.cap = capFig("Bar plots of livestock disturbance observed at springs in each park."), fig.alt = "Mojave has the most springs with evidence of livestock at 53%. Joshua Tree has the fewest at 0%. Data for each visit can be found in the table in section 4.7.11 Livestock presence."}
livestockplot <- LivestockPlot(field.season = year.range)

if (params$isAccessible == "yes") {
  livestockplot
} else {
  ggplotly(livestockplot)
}
```

### Livestock evidence map

This map shows where livestock disturbance was observed. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r livestockmap, echo = FALSE, message = FALSE, warning = FALSE, fig.alt = "Map of livestock evidence observations at desert springs. Data for each visit can be found in the table in section 4.7.11 Livestock presence."}
livestockmap <- LivestockMap(field.season = year.range)

livestockmap
```

`r capFig("Map of livestock disturbance observed at springs in each park.")`

## Wildlife evidence {.tabset .tabset-pills}

### Wildlife observed, no types recorded

This table lists visits where wildlife was observed, but no wildlife type was specified.

``` {r wildlifenotype, fig.cap = capTab("Wildlife was observed, but no wildlife type was specified.")}
wildlifenotype <- qcWildlifeObservedNoTypes(field.season = year.range)

reactable(dplyr::select(wildlifenotype, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                       header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- wildlifenotype$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Wildlife type specified, no evidence recorded

This table lists visits where wildlife type was specified, but no evidence type was recorded.

``` {r wildlifenoevidence, fig.cap = capTab("Wildlife type was specified, but no evidence type was recorded.")}
wildlifenoevidence <- qcWildlifeObservedNoEvidence(field.season = year.range)

reactable(dplyr::select(wildlifenoevidence, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                       header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- wildlifenoevidence$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Ungulates evidence

This table lists visits were evidence of ungulate (sheep or deer) activity was observed at a spring. Evidence can include direct observation, tracks, or scat.

``` {r ungulatesevidence, fig.cap = capTab("Ungulate activity observed at springs.")}
ungulatesevidence <- UngulatesEvidence(field.season = year.range)

reactable(dplyr::select(ungulatesevidence, -Notes),
            defaultColDef = reactable::colDef(minWidth = 100,
                                       header = function(value) snakecase::to_title_case(value)),
            details = reactable::colDef(
              name = "Notes",
              details = function(index) {
                note <- ungulatesevidence$Notes[index]
                if (!is.na(note)) {
                  return(note)
                }
              }
            ),
            sortable = TRUE,
            filterable = TRUE,
            compact = TRUE,
            striped = TRUE,
            bordered = TRUE,
            highlight = TRUE,
            resizable = TRUE)
```

### Ungulates evidence map

This map shows where evidence of ungulate (sheep or deer) activity was observed. Evidence can include direction observation, tracks, or scat. If there is a field season slider at the top of the map, then data from a specific field season may be selected. If there is no field season slider, then data from the most recent field season are shown.

``` {r ungulatesmap, echo = FALSE, message = FALSE, warning = FALSE, fig.alt = "Map of ungulates evidence observations at desert springs. Data for each visit can be found in the table in section 4.8.3 Ungulates evidence."}
ungulatesmap <- UngulatesMap(field.season = year.range)

ungulatesmap
```

`r capFig("Map of ungulate activity observed at springs in each park.")`

# Usage Notes
A MOJN Desert Springs R Package that is designed to work with the datasets in their published format is available on GitHub. This package was used to implement the QC checks that are included in this report and to generate the three calculated datasets that are included in this data package.

# Acknowledgements
The authors would like to acknowledge Geoff Moret, who developed the Desert Springs protocol. We would also like to thank Lise Grace for providing review and editing assistance on this data QC report.

# References

Bailard J.L., Moret G.J., Lehman M., Hupp N.R., Tallent N.G., Calvert A.W. 2018. Springs in the Mojave Desert Network—Surface water monitoring at desert springs: Standard operating procedures version 1.0. National Park Service. Fort Collins, Colorado. Available at: https://irma.nps.gov/DataStore/Reference/Profile/2256063

Bredehoeft, J. and T. Durbin. 2009. Ground water development -- the time to full capture problem. Ground Water: Vol. 47, Iss. 4, pp. 506–514. Available at: http://water.nv.gov/Hearings/past/Spring%20-%20Cave%20-%20Dry%20Lake%20and%20Delamar%20Valleys%202011/Exhibits/GBWN%20Exhibits/GBWN_Exh_012%20Bredehoeft%20Durbin_Ground%20Water%202009.pdf.

Gonzalez, P., G.M. Garfin, D.D. Breshears, K.M. Brooks, H.E. Brown, E.H. Elias, A. Gunasekara, N. Huntly, J.K. Maldonado, N.J. Mantua, H.G. Margolis, S. McAfee, B.R. Middleton, and B.H. Udall. 2018. Southwest. In Impacts, Risks, and Adaptation in the United States: Fourth National Climate Assessment, Volume II [Reidmiller, D.R., C.W. Avery, D.R. Easterling, K.E. Kunkel, K.L.M. Lewis, T.K. Maycock, and B.C. Stewart (eds.)]. U.S. Global Change Research Program, Washington, DC: pp. 1101–1184. doi: 10.7930/NCA4.2018.CH25. Available at: https://nca2018.globalchange.gov/chapter/25/

Moret G.J., Bailard J.L., Lehman M., Hupp N.R., Tallent N.G., Calvert A.W. 2018. Springs in the Mojave Desert Network—Surface water monitoring at desert springs: Protocol narrative version 1.0. Natural Resource Report. NPS/MOJN/NRR—2018/1718. National Park Service. Fort Collins, Colorado. Available at: https://irma.nps.gov/DataStore/Reference/Profile/2254900

\pagebreak

# Appendix A. Code Listing
```{r Listing, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

\pagebreak

# Appendix B. Session and Version Information
```{r session-info, echo=FALSE, cache=FALSE}
sessionInfo()
Sys.time()
```
